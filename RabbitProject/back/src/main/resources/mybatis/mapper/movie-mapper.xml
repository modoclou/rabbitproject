<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.company.project001.tmdb.UserMovieMapper">

    <!-- ðŸ” ê¸°ëŠ¥ 1: íšŒì›ê°€ìž… -->
    <insert id="insertUser" parameterType="User">
        INSERT INTO user(nickname, age, username, password, mbti)
        VALUES (#{nickname}, #{age}, #{username}, #{password}, #{mbti})
    </insert>

    <!-- ðŸ”‘ ê¸°ëŠ¥ 2: ë¡œê·¸ì¸ -->
    <select id="login" parameterType="map" resultType="User">
        SELECT * FROM user 
        WHERE username = #{username} AND password = #{password}
    </select>

    <!-- ðŸ”Ž ê¸°ëŠ¥ 3: ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° -->
    <select id="verifyUserInfoForReset" parameterType="map" resultType="User">
        SELECT * FROM user 
        WHERE username = #{username}
          AND mbti = #{mbti}
          AND age = #{age}
    </select>

    <!-- ðŸ›  ê¸°ëŠ¥ 4: ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ -->
    <update id="updatePassword" parameterType="map">
        UPDATE user
        SET password = #{newPassword}
        WHERE username = #{username}
    </update>

    <!-- âœ³ï¸ ì‚¬ìš©ìž ì •ë³´ ì¡°íšŒ -->
    <select id="findByUsername" parameterType="string" resultType="User">
        SELECT * FROM user WHERE username = #{username}
    </select>

    <!-- ðŸŽ¬ ê¸°ëŠ¥ 5: ì˜í™” ì €ìž¥ -->
    <insert id="insertMovie" parameterType="Movie">
        INSERT INTO movie(
            userid, adult, poster_path, title, original_title, overview, release_date
        ) VALUES (
            #{userid}, #{adult}, #{posterPath}, #{title}, #{originalTitle}, #{overview}, #{releaseDate}
        )
    </insert>

    <!-- ðŸŽž ê¸°ëŠ¥ 6: ì˜í™” ëª©ë¡ ì¡°íšŒ (ìœ ì €ë³„) -->
    <select id="findMoviesByUserId" parameterType="long" resultType="Movie">
        SELECT 
            id,
            userid,
            adult,
            poster_path AS posterPath,
            title,
            original_title AS originalTitle,
            overview,
            release_date AS releaseDate
        FROM movie
        WHERE userid = #{userid}
        ORDER BY release_date DESC
    </select>

</mapper>
